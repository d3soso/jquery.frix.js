
/* =============================

        FRIX.js

    ===============

    サイドバーなどのブロック要素をスクロールに合わせて位置をFIXします。
    上にスクロールした時に固定されたサイドバーもすぐ上に戻るのが特徴です。

    @author webwedge http://webwedge.jp/
    @version 0.5
    @licensed MIT license

    2017/07/24 0.5.001
    2017/07/03 0.5
    2017/04/28 0.1


============================== */

!function(t){var o=[],e="frix-decoy";t.fn.frix=function(){function e(){"static"===t(this).parent().css("position")&&t(this).parent().css("position","relative");var e=i.addDecoy(t(this));t(this).addClass("frix");var a={target:t(this),decoy:e,active:!0,flag:{top:!1,bottom:!1},top:0,last_scrollTop:0,scrollContainer:t(this).data("frix-container")?t(t(this).data("frix-container")):null,fixed_target:t(this).data("frix-fixed-target")?t(t(this).data("frix-fixed-target")):t(this).parent(),minWidth:t(this).data("frix-min-width")?t(this).data("frix-min-width"):-1,maxWidth:t(this).data("frix-max-width")?t(this).data("frix-max-width"):-1,defaultMarginTop:t(this).data("frix-scroll-margin-top")?t(this).data("frix-scroll-margin-top"):0,status:""};t(this).css("position","absolute"),t(this).css("top",i.getDecoyOffset(a).ptop),n(a),f(a).scroll(function(){r(a)}),g(a),o.push(a),l&&s()}function s(){t("body").append('<div id="frix-debug" class="frix-debug"><div class="frix-debug-inner"></div></div>'),t("body").append('<div id="frix-debug2" class="frix-debug"><div class="frix-debug-inner"></div></div>'),t(".frix-debug").css({position:"fixed",left:0,top:0,zIndex:99999,background:"#000"}),t("#frix-debug2").css({position:"fixed",left:0,top:202,zIndex:99999,background:"#000"}),t(".frix-debug-inner").css({width:300,height:200,padding:"10px",overflow:"auto"}),t("#frix-debug2 .frix-debug-inner").css({color:"#fff",fontSize:"10px",lineHeight:"1.2em"})}function a(){for(var e=0;e<o.length;e++)o[e].target.width(t(o[e].decoy).width()),n(o[e]),o[e].maxWidth<f(o[e]).width()&&o[e].maxWidth>=0?o[e].active=!1:o[e].minWidth>f(o[e]).width()&&o[e].minWidth>=0?o[e].active=!1:o[e].active=!0,r(o[e])}function r(t){t.active?("none"==t.decoy.css("display")&&t.decoy.css("display","block"),g(t)):(t.decoy.css("display","none"),t.target.css({position:t.decoy.css("position"),top:0,left:"initial"}))}function g(o){var e=f(o).scrollTop();if(o.status="",c(o)&&e>=p(o)-o.target.height()-o.defaultMarginTop?(o.status="Target.bottom below fixed_target.bottom // Target.height shorter than window.height",o.flag.top=o.flag.bottom=!1,o.top=o.fixed_target.height()-o.target.outerHeight()-parseInt(o.target.css("margin-bottom")),o.target.css({position:"absolute",top:o.top}),n(o)):!c(o)&&e>=p(o)-f(o).height()?(o.status="Target.bottom below fixed_target.bottom",o.flag.top=o.flag.bottom=!1,c(o)&&e>=p(o)-o.target.height()-o.defaultMarginTop?(o.status+=" // Target.height shorter than window.height",o.top=o.fixed_target.height()-o.target.outerHeight()-parseInt(o.target.css("margin-bottom"))):o.top=o.fixed_target.height()-o.target.outerHeight()-parseInt(o.target.css("margin-bottom")),o.fixed_target!==o.target.parent()&&(o.top+=parseInt(o.fixed_target.css("margin-top"))),o.target.css({position:"absolute",top:o.top}),n(o)):e<i.getDecoyOffset(o).vtop-o.defaultMarginTop?(o.status="Target.scrollTop above fixed_target.top",o.status+="//vtop : "+i.getDecoyOffset(o).vtop,o.flag.top=o.flag.bottom=!1,o.top=i.getDecoyOffset(o).ptop,t(o.target).css({position:"absolute",top:o.top}),n(o)):e>o.last_scrollTop?(o.status="target scroll down",o.flag.top&&!c(o)?(o.status+=" / Changed scroll direction: up->down",o.flag.top=!1,o.top=e-i.getDecoyOffset(o).vtop-o.defaultMarginTop,t(o.target).css({position:"absolute",top:o.top}),n(o)):c(o)&&e>i.getDecoyOffset(o).vtop-o.defaultMarginTop?(o.status+=" /  Scrolltop below target.bottom // Target.height shorter than window.height",o.flag.bottom=!0,o.top=o.defaultMarginTop,o.target.css({position:"fixed",top:o.top}),n(o)):!o.flag.bottom&&e>o.target.outerHeight()+i.getDecoyOffset(o).vtop+parseInt(o.target.css("margin-bottom"))+o.top-f(o).height()&&(o.status+=" / Scrolltop below target.bottom",o.flag.bottom=!0,o.top=f(o).height()-o.target.outerHeight()-parseInt(o.target.css("margin-bottom")),o.target.css({position:"fixed",top:o.top}),n(o))):e<o.last_scrollTop&&e>i.getDecoyOffset(o).vtop&&(o.status="target scroll up",o.flag.bottom&&!c(o)?(o.status+=" / Changed scroll direction: down->up obj.top:"+o.top,o.flag.bottom=!1,o.top=e-o.target.outerHeight()+f(o).height()-parseInt(o.target.css("margin-bottom"))-i.getDecoyOffset(o).vtop,o.status+="//"+o.top,o.target.css({position:"absolute",top:o.top}),n(o)):!o.flag.top&&e<o.top+i.getDecoyOffset(o).vtop&&(o.flag.top=!0,o.top=o.defaultMarginTop,o.status+=" / [asdf]obj.top:"+o.top,o.target.css({position:"fixed",top:o.top}),n(o))),o.last_scrollTop=e,l){var s="";s+=o.status,t("#frix-debug .frix-debug-inner").prepend('<p style="font-size:9px;color:#fff;line-height:1.2em;">'+s+"</p>");var a="";a+="scrollTop : "+e+"<br>",a+="getBottomY : "+p(o)+"<br>",a+="* : "+(o.target.outerHeight()+i.getDecoyOffset(o).vtop+parseInt(o.target.css("margin-bottom"))+o.top-f(o).height())+"<br>",a+="vtop : "+i.getDecoyOffset(o).vtop+"<br>",a+="target.Height() : "+o.target.outerHeight()+"<br>",a+="obj.top : "+o.top+"<br>",a+="marginTop : "+parseInt(o.target.css("margin-bottom"))+"<br>",a+="scrollContainer.H() : "+f(o).height()+"<br>",t("#frix-debug2 .frix-debug-inner").html(a)}}function n(t){"absolute"===t.target.css("position")?t.target.css("left",i.getDecoyOffset(t).left-t.target.parent().offset().left):"fixed"===t.target.css("position")&&t.target.css("left",i.getDecoyOffset(t).left)}function p(t){var o=t.fixed_target.offset().top;return t.scrollContainer&&(o+=t.scrollContainer.scrollTop()),o+t.fixed_target.height()}function f(o){return o.scrollContainer?o.scrollContainer:t(window)}function c(t){return t.target.height()<f(t).height()}var d=this,l=!1;t(document).ready(function(){d.each(e),t(window).resize(a),a()})};var s=function(){this.addDecoy=function(s){var i="frix-decoy-"+o.length,a=s.prop("tagName");s.before("<"+a+' id="'+i+'" class="'+e+'"></'+a+">");var r=t("#"+i);return s.data("frix-width")?r.width(s.data("frix-width")):r.width(s.width()),s.data("frix-height")?r.height(s.data("frix-height")):r.height(s.height()),s.width(r.width()),"static"!==s.css("position")&&r.css("position",s.css("position")),"auto"!==s.css("left")&&r.css("left",s.css("left")),"auto"!==s.css("right")&&r.css("right",s.css("right")),"auto"!==s.css("top")&&r.css("top",s.css("top")),"none"!==s.css("float")&&r.css("float",s.css("float")),0!==parseInt(s.css("margin-right"))&&r.css("margin-right",s.css("margin-right")),0!==parseInt(s.css("margin-left"))&&r.css("margin-left",s.css("margin-left")),0!==parseInt(s.css("margin-top"))&&r.css("margin-top",s.css("margin-top")),0!==parseInt(s.css("margin-bottom"))&&r.css("margin-bottom",s.css("margin-bottom")),0!==parseInt(s.css("padding-right"))&&r.css("padding-right",s.css("padding-right")),0!==parseInt(s.css("padding-left"))&&r.css("padding-left",s.css("padding-left")),0!==parseInt(s.css("padding-top"))&&r.css("padding-top",s.css("padding-top")),0!==parseInt(s.css("padding-bottom"))&&r.css("padding-bottom",s.css("padding-bottom")),r},this.getDecoyOffset=function(t){if(t.decoy.hasClass(e)){var o=t.decoy.offset(),s=t.decoy.parent().offset();return t.scrollContainer?virtual={top:o.top+t.scrollContainer.scrollTop(),left:o.left+t.scrollContainer.scrollLeft()}:virtual={top:o.top,left:o.left},{top:o.top,left:o.left,ptop:o.top-s.top-parseInt(t.target.css("margin-top")),pleft:o.left-s.left-parseInt(t.target.css("margin-left")),vtop:virtual.top,vleft:virtual.left}}}},i=new s}($);
